---
# roles/network/tasks/main.yml

- name: Delete unwanted auto-generated Wired connection 1
  command: nmcli connection delete "Wired connection 1"
  ignore_errors: true
  become: true

- name: Ensure eth0 connection profile exists
  command: nmcli connection add type ethernet ifname eth0 con-name eth0
  args:
    creates: /etc/NetworkManager/system-connections/eth0.nmconnection
  become: true

- name: Set static IP address
  command: nmcli connection modify eth0 ipv4.addresses "{{ nm_ip }}"
  become: true

- name: Set manual method for IPv4
  command: nmcli connection modify eth0 ipv4.method manual
  become: true

- name: Set gateway
  command: nmcli connection modify eth0 ipv4.gateway "{{ nm_gateway }}"
  become: true

- name: Set DNS
  command: nmcli connection modify eth0 ipv4.dns "{{ nm_dns }}"
  become: true