# Hybrid Application Management - Visual Guide

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          APPLICATION CATALOG                                â”‚
â”‚                       (applications table)                                  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ID: 1001 (from global_app_id_seq starting at 1000)                 â”‚  â”‚
â”‚  â”‚  App Name: "monitoring"                                              â”‚  â”‚
â”‚  â”‚  Slug: "monitoring-stack"                                            â”‚  â”‚
â”‚  â”‚  Default Config (Template):                                          â”‚  â”‚
â”‚  â”‚  {                                                                   â”‚  â”‚
â”‚  â”‚    "services": [                                                     â”‚  â”‚
â”‚  â”‚      {                                                               â”‚  â”‚
â”‚  â”‚        "serviceName": "prometheus",                                  â”‚  â”‚
â”‚  â”‚        "image": "prom/prometheus:latest",                            â”‚  â”‚
â”‚  â”‚        "defaultPorts": ["9090:9090"],                                â”‚  â”‚
â”‚  â”‚        "defaultEnvironment": { "RETENTION": "30d" }                  â”‚  â”‚
â”‚  â”‚      },                                                              â”‚  â”‚
â”‚  â”‚      {                                                               â”‚  â”‚
â”‚  â”‚        "serviceName": "grafana",                                     â”‚  â”‚
â”‚  â”‚        "image": "grafana/grafana:latest",                            â”‚  â”‚
â”‚  â”‚        "defaultPorts": ["3000:3000"]                                 â”‚  â”‚
â”‚  â”‚      }                                                               â”‚  â”‚
â”‚  â”‚    ]                                                                 â”‚  â”‚
â”‚  â”‚  }                                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  Think of this as: "Docker Hub" - where you store reusable images/stacks   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Deploy with customization
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DEVICE DEPLOYMENT                                    â”‚
â”‚                  (device_target_state.apps JSONB)                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Device A (Pi in Office)     â”‚    â”‚  Device B (Pi in Factory)    â”‚     â”‚
â”‚  â”‚  UUID: abc123...             â”‚    â”‚  UUID: xyz789...             â”‚     â”‚
â”‚  â”‚                              â”‚    â”‚                              â”‚     â”‚
â”‚  â”‚  {                           â”‚    â”‚  {                           â”‚     â”‚
â”‚  â”‚    "1001": {                 â”‚    â”‚    "1001": {                 â”‚     â”‚
â”‚  â”‚      appId: 1001,            â”‚    â”‚      appId: 1001,            â”‚     â”‚
â”‚  â”‚      appName: "monitoring",  â”‚    â”‚      appName: "monitoring",  â”‚     â”‚
â”‚  â”‚      services: [             â”‚    â”‚      services: [             â”‚     â”‚
â”‚  â”‚        {                     â”‚    â”‚        {                     â”‚     â”‚
â”‚  â”‚          serviceId: 1,       â”‚    â”‚          serviceId: 3,       â”‚     â”‚
â”‚  â”‚          serviceName: "prom",â”‚    â”‚          serviceName: "prom",â”‚     â”‚
â”‚  â”‚          image: "prom:latest"â”‚    â”‚          image: "prom:latest"â”‚     â”‚
â”‚  â”‚          config: {           â”‚    â”‚          config: {           â”‚     â”‚
â”‚  â”‚            ports: [          â”‚    â”‚            ports: [          â”‚     â”‚
â”‚  â”‚              "9090:9090" â—„â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  "8097:9090" â—„â”€â”€â”€â”¼â”€â”   â”‚
â”‚  â”‚            ],                â”‚    â”‚            ],                â”‚ â”‚   â”‚
â”‚  â”‚            environment: {    â”‚    â”‚            environment: {    â”‚ â”‚   â”‚
â”‚  â”‚              RETENTION: "30d"â”‚    â”‚              RETENTION: "7d" â”‚ â”‚   â”‚
â”‚  â”‚            }                 â”‚    â”‚            }                 â”‚ â”‚   â”‚
â”‚  â”‚          }                   â”‚    â”‚          }                   â”‚ â”‚   â”‚
â”‚  â”‚        },                    â”‚    â”‚        },                    â”‚ â”‚   â”‚
â”‚  â”‚        {                     â”‚    â”‚        {                     â”‚ â”‚   â”‚
â”‚  â”‚          serviceId: 2,       â”‚    â”‚          serviceId: 4,       â”‚ â”‚   â”‚
â”‚  â”‚          serviceName: "graf",â”‚    â”‚          serviceName: "graf",â”‚ â”‚   â”‚
â”‚  â”‚          config: {           â”‚    â”‚          config: {           â”‚ â”‚   â”‚
â”‚  â”‚            ports: [          â”‚    â”‚            ports: [          â”‚ â”‚   â”‚
â”‚  â”‚              "3000:3000"     â”‚    â”‚              "8098:3000"     â”‚ â”‚   â”‚
â”‚  â”‚            ]                 â”‚    â”‚            ]                 â”‚ â”‚   â”‚
â”‚  â”‚          }                   â”‚    â”‚          }                   â”‚ â”‚   â”‚
â”‚  â”‚        }                     â”‚    â”‚        }                     â”‚ â”‚   â”‚
â”‚  â”‚      ]                       â”‚    â”‚      ]                       â”‚ â”‚   â”‚
â”‚  â”‚    }                         â”‚    â”‚    }                         â”‚ â”‚   â”‚
â”‚  â”‚  }                           â”‚    â”‚  }                           â”‚ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚                                                                        â”‚   â”‚
â”‚  Same app (1001), different configs! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  Notice: Different ports (9090 vs 8097), different retention (30d vs 7d)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin/User   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Create application template
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/v1/applications            â”‚
â”‚                                      â”‚
â”‚ {                                    â”‚
â”‚   appName: "monitoring",             â”‚
â”‚   slug: "monitoring-stack",          â”‚
â”‚   defaultConfig: { services: [...] } â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Generate app ID from sequence
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT nextval('global_app_id_seq')  â”‚
â”‚ â†’ Returns: 1001                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Store in applications table
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSERT INTO applications             â”‚
â”‚   (id, app_name, slug, default_config)
â”‚ VALUES (1001, 'monitoring', ...)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Deploy to device
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/v1/devices/{uuid}/apps    â”‚
â”‚                                      â”‚
â”‚ {                                    â”‚
â”‚   appId: 1001,                       â”‚
â”‚   services: [                        â”‚
â”‚     {                                â”‚
â”‚       serviceName: "prometheus",     â”‚
â”‚       image: "prom:latest",          â”‚
â”‚       ports: ["8097:9090"],  â—„â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€ Custom port!
â”‚       environment: {                 â”‚
â”‚         RETENTION: "14d"     â—„â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€ Custom config!
â”‚       }                              â”‚
â”‚     }                                â”‚
â”‚   ]                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Generate service IDs
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For each service:                    â”‚
â”‚   SELECT nextval('global_service...')â”‚
â”‚   â†’ Returns: 1, 2, 3...              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Store in device_target_state
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UPDATE device_target_state           â”‚
â”‚ SET apps = {                         â”‚
â”‚   "1001": {                          â”‚
â”‚     appId: 1001,                     â”‚
â”‚     appName: "monitoring",           â”‚
â”‚     services: [                      â”‚
â”‚       { serviceId: 1, ... },         â”‚
â”‚       { serviceId: 2, ... }          â”‚
â”‚     ]                                â”‚
â”‚   }                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Device polls for state
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/v1/device/{uuid}/state      â”‚
â”‚ â†’ Returns full apps JSONB            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 8. Device applies configuration
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Device Agent:                        â”‚
â”‚  - Reads services array              â”‚
â”‚  - Pulls Docker images               â”‚
â”‚  - Creates containers                â”‚
â”‚  - Applies ports, env, volumes       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Comparison: Docker Analogy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Docker World                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Docker Hub                                                     â”‚
â”‚  â””â”€â”€ nginx:latest (image registry)                             â”‚
â”‚                                                                 â”‚
â”‚  docker-compose.yml (template)                                 â”‚
â”‚  services:                                                      â”‚
â”‚    web:                                                         â”‚
â”‚      image: nginx:latest                                        â”‚
â”‚      ports: ["80:80"]                                           â”‚
â”‚                                                                 â”‚
â”‚  docker-compose.override.yml (customization)                   â”‚
â”‚  services:                                                      â”‚
â”‚    web:                                                         â”‚
â”‚      ports: ["8080:80"]  â—„â”€â”€ Override default!                 â”‚
â”‚                                                                 â”‚
â”‚  docker ps (running containers)                                â”‚
â”‚  nginx:latest â†’ running on port 8080                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†• Equivalent
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Our Hybrid Approach                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  applications table (catalog)                                   â”‚
â”‚  â””â”€â”€ monitoring:1001 (template registry)                       â”‚
â”‚                                                                 â”‚
â”‚  default_config (template)                                     â”‚
â”‚  services: [                                                    â”‚
â”‚    {                                                            â”‚
â”‚      serviceName: "nginx",                                      â”‚
â”‚      image: "nginx:latest",                                     â”‚
â”‚      defaultPorts: ["80:80"]                                    â”‚
â”‚    }                                                            â”‚
â”‚  ]                                                              â”‚
â”‚                                                                 â”‚
â”‚  POST /devices/{uuid}/apps (customization)                     â”‚
â”‚  services: [                                                    â”‚
â”‚    {                                                            â”‚
â”‚      serviceName: "nginx",                                      â”‚
â”‚      ports: ["8080:80"]  â—„â”€â”€ Override default!                 â”‚
â”‚    }                                                            â”‚
â”‚  ]                                                              â”‚
â”‚                                                                 â”‚
â”‚  device_target_state.apps (deployed state)                     â”‚
â”‚  { "1001": { services: [...] } } â†’ deployed on device          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Concepts Visualized

### 1. Same App, Different Devices

```
Application Template (ID: 1001)
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â†“                   â†“                   â†“
   Device A           Device B           Device C
   
   Port: 9090         Port: 8097         Port: 7070
   Retention: 30d     Retention: 7d      Retention: 90d
   Password: abc      Password: xyz      Password: 123
```

### 2. App Hierarchy

```
Application (1001: "monitoring")
    â”‚
    â”œâ”€â”€ Service 1 (serviceId: 1, "prometheus")
    â”‚   â”œâ”€â”€ Image: prom/prometheus:latest
    â”‚   â”œâ”€â”€ Ports: ["9090:9090"]
    â”‚   â””â”€â”€ Environment: { RETENTION: "30d" }
    â”‚
    â””â”€â”€ Service 2 (serviceId: 2, "grafana")
        â”œâ”€â”€ Image: grafana/grafana:latest
        â”œâ”€â”€ Ports: ["3000:3000"]
        â””â”€â”€ Environment: { GF_... }
```

### 3. ID Generation

```
global_app_id_seq
    â”‚
    â”œâ”€â”€ 1000 (first user app)
    â”œâ”€â”€ 1001 (monitoring)
    â”œâ”€â”€ 1002 (web-server)
    â””â”€â”€ 1003 (database)

global_service_id_seq
    â”‚
    â”œâ”€â”€ 1 (prometheus on device A)
    â”œâ”€â”€ 2 (grafana on device A)
    â”œâ”€â”€ 3 (prometheus on device B)
    â””â”€â”€ 4 (grafana on device B)
```

### 4. Data Flow

```
User Input â†’ Template â†’ Customization â†’ Deployment â†’ Device State

1. Create:
   appName: "monitoring"
   defaultConfig: { ... }

2. Store:
   applications.id = 1001
   applications.default_config = { ... }

3. Deploy:
   appId: 1001
   services: [custom config]

4. Generate:
   serviceId: 1, 2, 3...

5. Store:
   device_target_state.apps = {
     "1001": { services: [...] }
   }

6. Poll:
   GET /device/{uuid}/state
   â†’ Returns apps JSONB

7. Apply:
   Device reads JSONB
   â†’ Creates containers
```

## Benefits Visualized

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WITHOUT Hybrid Approach (Pure JSONB)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Device A:           Device B:           Device C:         â”‚
â”‚  { apps: {           { apps: {           { apps: {         â”‚
â”‚    "monitoring": {     "monitoring": {     "monitoring": { â”‚
â”‚      services: [...]    services: [...]     services: [...] â”‚
â”‚    }                   }                   }               â”‚
â”‚  }}                  }}                  }}                â”‚
â”‚                                                             â”‚
â”‚  âŒ No reusability - copy-paste everywhere                 â”‚
â”‚  âŒ Can't query "what apps exist?"                          â”‚
â”‚  âŒ No central management                                   â”‚
â”‚  âŒ Inconsistent naming                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WITH Hybrid Approach (Catalog + JSONB)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Catalog:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ 1001: monitoring (template)    â”‚                        â”‚
â”‚  â”‚ 1002: web-server (template)    â”‚                        â”‚
â”‚  â”‚ 1003: database (template)      â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â†“            â†“            â†“                         â”‚
â”‚    Device A      Device B      Device C                    â”‚
â”‚    {1001}        {1001}        {1001, 1002}                â”‚
â”‚    custom        custom        custom                      â”‚
â”‚                                                             â”‚
â”‚  âœ… Reusable templates                                      â”‚
â”‚  âœ… Central catalog: SELECT * FROM applications            â”‚
â”‚  âœ… Device-specific configs                                 â”‚
â”‚  âœ… Consistent IDs and naming                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Think of it as:**
- **Application Catalog** = Your private Docker Hub
- **Default Config** = docker-compose.yml template
- **Device Deployment** = docker-compose up with overrides
- **Device State** = docker ps (what's running)

**Perfect for multi-device IoT deployments!** ğŸš€
