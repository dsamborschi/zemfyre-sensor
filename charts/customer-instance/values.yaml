# Default values for customer-instance
# This is a YAML-formatted file.

# Customer information (set during deployment)
customer:
  id: ""
  email: ""
  companyName: ""
  plan: "starter"  # starter, professional, enterprise

# License key (JWT)
license:
  key: ""
  # publicKey is injected at deploy time from billing service (not stored in Git!)
  publicKey: ""

# Domain configuration
domain:
  base: "iotistic.ca"
  # Instance will be accessible at: {customer.id}.{domain.base}

# PostgreSQL database
postgres:
  enabled: true
  image:
    repository: postgres
    tag: "15-alpine"
  storage:
    size: 10Gi
    storageClass: ""
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  database: Iotistic
  username: Iotistic
  # Password will be auto-generated if not provided
  password: ""
  # Prometheus metrics exporter
  metrics:
    enabled: true
    port: 9187

# Mosquitto MQTT broker
mosquitto:
  enabled: true
  image:
    repository: iegomez/mosquitto-go-auth
    tag: "latest"
  ports:
    mqtt: 1883
    websocket: 9001
  resources:
    requests:
      cpu: 100m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi
  # PostgreSQL authentication configuration
  auth:
    allowAnonymous: false
    hasher: bcrypt
    hasherCost: 10
    logLevel: info
  # Default MQTT credentials for API service
  credentials:
    username: "admin"
    password: ""  # Auto-generated if empty
  # Prometheus metrics exporter
  metrics:
    enabled: true
    port: 9234
    exporter:
      image:
        repository: sapcc/mosquitto-exporter
        tag: "0.8.0"
      resources:
        requests:
          cpu: 50m
          memory: 64Mi
        limits:
          cpu: 100m
          memory: 128Mi

# API service
api:
  enabled: true
  image:
    repository: iotistic/api
    tag: latest
  replicas: 1
  port: 3002
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  env:
    NODE_ENV: production
    LOG_LEVEL: info

# Dashboard (admin panel)
dashboard:
  enabled: true
  image:
    repository: iotistic/dashboard
    tag: latest
  replicas: 1
  port: 80
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Prometheus exporter (metrics)
exporter:
  enabled: false  # Disabled - image not built yet
  image:
    repository: iotistic/billing-exporter
    tag: latest
  port: 8080
  prometheusUrl: "http://prometheus-kube-prometheus-prometheus.monitoring:9090"
  billingApiUrl: "http://billing-service.default:3000"
  collectionInterval: "3600000"  # 1 hour in milliseconds
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  tls:
    enabled: true

# Resource quotas for namespace
resourceQuota:
  enabled: true
  cpu: "4"
  memory: "4Gi"
  pvcs: "5"
  services: "10"

# Network policies
networkPolicy:
  enabled: true
  # Allow ingress from Ingress controller only
  allowExternal: true

# Monitoring configuration
monitoring:
  # Enable metrics collection (always enabled for all tiers)
  enabled: true
  
  # Dedicated Prometheus instance (Enterprise tier only - premium feature)
  # When false: uses shared cluster Prometheus (recommended for most customers)
  # When true: deploys dedicated Prometheus in customer namespace
  dedicated: false
  
  # Scrape interval for metrics collection
  scrapeInterval: "30s"
  
  # Retention period for dedicated Prometheus (ignored if dedicated=false)
  retention: "15d"  # Enterprise: 15 days, can be increased with premium
  
  # Storage size for dedicated Prometheus
  storageSize: "10Gi"
  
  # Resources for dedicated Prometheus
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  
  # Grafana for dedicated monitoring (Enterprise tier only)
  grafana:
    enabled: false  # Only if monitoring.dedicated=true
    adminPassword: ""  # Auto-generated if empty
