{{- if .Values.postgres.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "customer-instance.fullname" . }}-secrets
  labels:
    {{- include "customer-instance.labels" . | nindent 4 }}
type: Opaque
stringData:
  # License key
  IOTISTIC_LICENSE_KEY: {{ .Values.license.key | quote }}
  
  # PostgreSQL credentials
  POSTGRES_USER: {{ .Values.postgres.username | quote }}
  POSTGRES_PASSWORD: {{ include "customer-instance.postgresPassword" . | quote }}
  POSTGRES_DB: {{ .Values.postgres.database | quote }}
  
  # Database connection string for services
  DATABASE_URL: "postgresql://{{ .Values.postgres.username }}:{{ include "customer-instance.postgresPassword" . }}@{{ include "customer-instance.fullname" . }}-postgres:5432/{{ .Values.postgres.database }}"
  
  # Customer information
  CUSTOMER_ID: {{ .Values.customer.id | quote }}
  CUSTOMER_EMAIL: {{ .Values.customer.email | quote }}
  CUSTOMER_COMPANY: {{ .Values.customer.companyName | quote }}
{{- end }}
