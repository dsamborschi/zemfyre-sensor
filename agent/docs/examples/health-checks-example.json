{
  "apps": {
    "1": {
      "id": 1,
      "name": "mqtt-stack",
      "services": {
        "mosquitto": {
          "id": "mosquitto",
          "image": "iotistic/mosquitto:latest",
          "config": {
            "image": "iotistic/mosquitto:latest",
            "ports": ["1883:1883", "9001:9001"],
            "volumes": [
              "mosquitto_data:/mosquitto/data",
              "mosquitto_log:/mosquitto/log"
            ],
            "restart": "unless-stopped",
            "resources": {
              "limits": {
                "cpu": "0.5",
                "memory": "256Mi"
              },
              "requests": {
                "cpu": "0.1",
                "memory": "128Mi"
              }
            },
            "livenessProbe": {
              "type": "tcp",
              "port": 1883,
              "initialDelaySeconds": 10,
              "periodSeconds": 60,
              "timeoutSeconds": 3,
              "failureThreshold": 3
            },
            "readinessProbe": {
              "type": "exec",
              "command": ["mosquitto_sub", "-t", "$SYS/#", "-C", "1", "-W", "2"],
              "initialDelaySeconds": 5,
              "periodSeconds": 10,
              "timeoutSeconds": 5,
              "failureThreshold": 2
            }
          }
        }
      }
    },
    "2": {
      "id": 2,
      "name": "automation-stack",
      "services": {
        "nodered": {
          "id": "nodered",
          "image": "iotistic/node-red:latest",
          "config": {
            "image": "iotistic/node-red:latest",
            "ports": ["1880:1880"],
            "volumes": ["nodered_data:/data"],
            "environment": {
              "TZ": "America/New_York"
            },
            "restart": "unless-stopped",
            "resources": {
              "limits": {
                "cpu": "1",
                "memory": "512Mi"
              },
              "requests": {
                "cpu": "0.2",
                "memory": "256Mi"
              }
            },
            "startupProbe": {
              "type": "http",
              "path": "/",
              "port": 1880,
              "periodSeconds": 10,
              "failureThreshold": 30,
              "timeoutSeconds": 5
            },
            "livenessProbe": {
              "type": "http",
              "path": "/",
              "port": 1880,
              "initialDelaySeconds": 30,
              "periodSeconds": 30,
              "timeoutSeconds": 10,
              "failureThreshold": 2
            },
            "readinessProbe": {
              "type": "http",
              "path": "/",
              "port": 1880,
              "initialDelaySeconds": 15,
              "periodSeconds": 10,
              "timeoutSeconds": 5,
              "failureThreshold": 2
            }
          }
        }
      }
    },
    "3": {
      "id": 3,
      "name": "timeseries-stack",
      "services": {
        "influxdb": {
          "id": "influxdb",
          "image": "influxdb:2.7",
          "config": {
            "image": "influxdb:2.7",
            "ports": ["8086:8086"],
            "volumes": [
              "influxdb_data:/var/lib/influxdb2",
              "influxdb_config:/etc/influxdb2"
            ],
            "environment": {
              "DOCKER_INFLUXDB_INIT_MODE": "setup",
              "DOCKER_INFLUXDB_INIT_USERNAME": "admin",
              "DOCKER_INFLUXDB_INIT_PASSWORD": "adminpassword",
              "DOCKER_INFLUXDB_INIT_ORG": "iotistic",
              "DOCKER_INFLUXDB_INIT_BUCKET": "sensors"
            },
            "restart": "unless-stopped",
            "resources": {
              "limits": {
                "cpu": "2",
                "memory": "2Gi"
              },
              "requests": {
                "cpu": "0.5",
                "memory": "512Mi"
              }
            },
            "startupProbe": {
              "type": "http",
              "path": "/health",
              "port": 8086,
              "initialDelaySeconds": 0,
              "periodSeconds": 10,
              "timeoutSeconds": 5,
              "failureThreshold": 30
            },
            "livenessProbe": {
              "type": "http",
              "path": "/health",
              "port": 8086,
              "periodSeconds": 60,
              "timeoutSeconds": 5,
              "failureThreshold": 3
            },
            "readinessProbe": {
              "type": "http",
              "path": "/ping",
              "port": 8086,
              "periodSeconds": 10,
              "timeoutSeconds": 3,
              "failureThreshold": 2
            }
          }
        }
      }
    },
    "4": {
      "id": 4,
      "name": "visualization-stack",
      "services": {
        "grafana": {
          "id": "grafana",
          "image": "grafana/grafana:latest",
          "config": {
            "image": "grafana/grafana:latest",
            "ports": ["3000:3000"],
            "volumes": ["grafana_data:/var/lib/grafana"],
            "environment": {
              "GF_SECURITY_ADMIN_USER": "admin",
              "GF_SECURITY_ADMIN_PASSWORD": "admin",
              "GF_INSTALL_PLUGINS": "grafana-clock-panel"
            },
            "restart": "unless-stopped",
            "resources": {
              "limits": {
                "cpu": "1",
                "memory": "512Mi"
              },
              "requests": {
                "cpu": "0.2",
                "memory": "256Mi"
              }
            },
            "startupProbe": {
              "type": "http",
              "path": "/api/health",
              "port": 3000,
              "periodSeconds": 10,
              "failureThreshold": 30,
              "timeoutSeconds": 5
            },
            "livenessProbe": {
              "type": "http",
              "path": "/api/health",
              "port": 3000,
              "periodSeconds": 60,
              "timeoutSeconds": 5,
              "failureThreshold": 3
            },
            "readinessProbe": {
              "type": "http",
              "path": "/api/health",
              "port": 3000,
              "periodSeconds": 10,
              "timeoutSeconds": 3,
              "failureThreshold": 2
            }
          }
        }
      }
    },
    "5": {
      "id": 5,
      "name": "database-stack",
      "services": {
        "postgres": {
          "id": "postgres",
          "image": "postgres:15",
          "config": {
            "image": "postgres:15",
            "ports": ["5432:5432"],
            "volumes": ["postgres_data:/var/lib/postgresql/data"],
            "environment": {
              "POSTGRES_USER": "postgres",
              "POSTGRES_PASSWORD": "postgres",
              "POSTGRES_DB": "iotistic"
            },
            "restart": "unless-stopped",
            "resources": {
              "limits": {
                "cpu": "1",
                "memory": "1Gi"
              },
              "requests": {
                "cpu": "0.25",
                "memory": "256Mi"
              }
            },
            "startupProbe": {
              "type": "exec",
              "command": ["pg_isready", "-h", "localhost", "-U", "postgres"],
              "periodSeconds": 5,
              "failureThreshold": 60,
              "timeoutSeconds": 5
            },
            "livenessProbe": {
              "type": "exec",
              "command": ["pg_isready", "-h", "localhost", "-U", "postgres"],
              "initialDelaySeconds": 30,
              "periodSeconds": 30,
              "timeoutSeconds": 5,
              "failureThreshold": 3
            },
            "readinessProbe": {
              "type": "exec",
              "command": ["pg_isready", "-h", "localhost", "-U", "postgres"],
              "initialDelaySeconds": 10,
              "periodSeconds": 10,
              "timeoutSeconds": 5,
              "failureThreshold": 2
            }
          }
        }
      }
    }
  }
}
